ğŸš€ Day 9 â€“ Zomato SQL Interview (Retention Logic â€“ Advanced)

Retention questions donâ€™t fail candidates because of SQL syntax.
They fail candidates because of definition mistakes ğŸ“‰

ğŸ“Œ Business Problem

Zomato wants to measure restaurant retention month-over-month.

A restaurant is retained in month M if:

It received â‰¥ 1 order in month M

AND â‰¥ 1 order in month Mâˆ’1

ğŸ¯ Interview Task

Calculate month-wise retained restaurant count.

ğŸ”’ Strict Rules (Interview-Traps Included ğŸ˜ˆ)

Retention is checked only between consecutive months

Ignore the first month (no previous data)

Handle missing months correctly

Output:

month

retained_restaurant_count

ğŸ§© SQL Solution (Interview-Ready)
WITH monthly_orders AS (
    SELECT DISTINCT
        restaurant_id,
        DATE_FORMAT(order_date, '%Y-%m') AS ym
    FROM orders
),
retention_flag AS (
    SELECT
        restaurant_id,
        ym,
        LAG(ym) OVER (
            PARTITION BY restaurant_id
            ORDER BY ym
        ) AS prev_ym
    FROM monthly_orders
)
SELECT
    ym AS month,
    COUNT(DISTINCT restaurant_id) AS retained_restaurant_count
FROM retention_flag
WHERE TIMESTAMPDIFF(
          MONTH,
          STR_TO_DATE(prev_ym, '%Y-%m'),
          STR_TO_DATE(ym, '%Y-%m')
      ) = 1
GROUP BY ym
ORDER BY ym;

ğŸ“Œ Why This Is Advanced

Monthly aggregation before retention logic

Correct use of LAG() (not naive self-joins)

Explicit handling of missing months

Filters only true MoM retention

Many candidates:
âŒ Compare any two months
âŒ Miss gaps
âŒ Overcount retained restaurants

This solution avoids all three.

Retention logic like this is used in:

Marketplace health metrics

Seller lifecycle tracking

Growth & churn dashboards

If you can reason through this calmly,
youâ€™re thinking like a senior analytics / data engineer.

Day 10 will be harder ğŸ”¥
ğŸ‘‡ Would you solve this using a self-join instead?

#SQL #Zomato #DataAnalytics #DataEngineering
#InterviewPrep #RetentionAnalysis #WindowFunctions #AdvancedSQL #30DaysOfSQL
